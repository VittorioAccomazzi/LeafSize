!function(){"use strict";var e={765:function(e,t,n){var i=n(5861),a=n(7757),r=n.n(a),u="/LeafSize/",s=("".concat(u,"settings"),"".concat(u),"".concat(u,"process"),"".concat(u,"result"),n(5671)),o=n(3144);function h(e){var t=e.lastIndexOf("."),n=e;return t>0&&(n=e.substring(0,t)),n}var c=function(){function e(t,n,i){var a=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:l;if((0,s.Z)(this,e),this.tiles=[],this.cacheImage=null,this.cacheFile=null,this.getImageFromFile=void 0,this.targetSize=void 0,this.tiles=[],this.getImageFromFile=r,this.targetSize=i,1!==n&&4!==n)throw new Error("not supported num Dishes ".concat(n));if(t)switch(n){case 1:this.tiles=t.map((function(e){return{file:e,quadrant:"All",name:h(e.name)}}));break;case 4:t.forEach((function(e){["Q0","Q1","Q2","Q3"].forEach((function(t){a.tiles.push({file:e,name:h(e.name)+"-"+t,quadrant:t})}))}))}}return(0,o.Z)(e,[{key:"List",get:function(){return this.tiles.map((function(e){return e.name}))}},{key:"FileHandle",value:function(e){var t;return null===(t=this.tiles.find((function(t){return t.name===e})))||void 0===t?void 0:t.file}},{key:"NumDishes",get:function(){return new Set(this.tiles.map((function(e){return e.quadrant}))).size}},{key:"getImage",value:function(){var e=(0,i.Z)(r().mark((function e(t){var n,i,a,u,s,o,h,c,l,f,g,v,m,x,y,p,d,k,w;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=0,i=null,this.tiles&&this.tiles.length){e.next=4;break}return e.abrupt("return",{scale:n,imgData:i});case 4:if(!(t<0||t>this.tiles.length)){e.next=6;break}throw Error("undexpected index : requested ".concat(t," but got ").concat(this.tiles.length));case 6:return a=this.tiles[t],e.next=9,this.getImageFromCache(a);case 9:u=e.sent,s=u.width,o=u.height,h=0,c=0,l=s,f=o,g=s/2|0,v=o/2|0,e.t0=a.quadrant,e.next="Q0"===e.t0?21:"Q1"===e.t0?26:"Q2"===e.t0?31:"Q3"===e.t0?36:41;break;case 21:return h=0,c=0,l=g,f=v,e.abrupt("break",41);case 26:return h=g,c=0,l=s,f=v,e.abrupt("break",41);case 31:return h=0,c=v,l=g,f=o,e.abrupt("break",41);case 36:return h=g,c=v,l=s,f=o,e.abrupt("break",41);case 41:return m=l-h,x=f-c,y=Math.sqrt(x*x+m*m),n=Math.min(1,this.targetSize/y),p=m*n,d=x*n,"undefined"===typeof document?k=new OffscreenCanvas(p,d):((k=document.createElement("canvas")).width=p,k.height=d),(w=k.getContext("2d"))&&(w.drawImage(u,h,c,m,x,0,0,p,d),i=w.getImageData(0,0,p,d)),e.abrupt("return",{scale:n,imgData:i});case 51:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getImageFromCache",value:function(){var e=(0,i.Z)(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.cacheFile===t.file){e.next=6;break}return this.cacheImage&&this.cacheImage.close(),e.next=4,this.getImageFromFile(t.file);case 4:this.cacheImage=e.sent,this.cacheFile=t.file;case 6:return e.abrupt("return",this.cacheImage);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function l(e){return f.apply(this,arguments)}function f(){return(f=(0,i.Z)(r().mark((function e(t){var n,i,a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getFile();case 2:return n=e.sent,e.next=5,n.arrayBuffer();case 5:return i=e.sent,a=new Blob([i]),e.abrupt("return",createImageBitmap(a));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var g=n(2982),v=n(7762);var m=function(){function e(t,n){(0,s.Z)(this,e),this.pixels=void 0,this.w=void 0,this.w=t,this.pixels=new Array(t*n).fill(!1)}return(0,o.Z)(e,[{key:"imagePixels",get:function(){return this.pixels}},{key:"width",get:function(){return this.w}},{key:"height",get:function(){return this.pixels.length/this.w}},{key:"area",get:function(){return this.pixels.reduce((function(e,t){return e+(t?1:0)}),0)}},{key:"get",value:function(e,t){return this.checkSize(e,t),this.pixels[this.w*t+e]}},{key:"set",value:function(e,t,n){this.checkSize(e,t),this.pixels[this.w*t+e]=n}},{key:"toString",value:function(){return"Mask ".concat(this.width,"x").concat(this.height)}},{key:"And",value:function(e){if(e.pixels.length!==this.pixels.length)throw new Error("Wrong Mask sizes : ".concat(e.pixels.length," vs ").concat(this.pixels.length));this.pixels=this.pixels.map((function(t,n){return t&&e.pixels[n]}))}},{key:"Or",value:function(e){if(e.pixels.length!==this.pixels.length)throw new Error("Wrong Mask sizes : ".concat(e.pixels.length," vs ").concat(this.pixels.length));this.pixels=this.pixels.map((function(t,n){return t||e.pixels[n]}))}},{key:"Minus",value:function(e){var t=this;if(e.pixels.length!==this.pixels.length)throw new Error("Wrong Mask sizes : ".concat(e.pixels.length," vs ").concat(this.pixels.length));e.pixels.forEach((function(e,n){return e?t.pixels[n]=!1:null}))}},{key:"Not",value:function(){this.pixels=this.pixels.map((function(e){return!e}))}},{key:"foreachPixel",value:function(e){var t=this;this.pixels.forEach((function(n,i){var a=i%t.w,r=i/t.w|0;e(a,r,n)}))}},{key:"IsEmpty",get:function(){return!this.w||!this.pixels.length}},{key:"Fill",value:function(t,n){var i=this.width,a=this.height;if(t<0||t>=i||n<0||n>=a)throw new Error("invalid seed point ".concat(t,",").concat(n));var r=this.pixels,u=new e(i,a),s=u.imagePixels,o=[{x:-1,y:0},{x:1,y:0},{x:0,y:1},{x:0,y:-1},{x:1,y:1},{x:-1,y:1},{x:1,y:-1},{x:-1,y:-1}],h=[{x:t,y:n}];for(s[n*i+t]=!0;h.length>0;){var c,l=h.shift(),f=(0,v.Z)(o);try{for(f.s();!(c=f.n()).done;){var g=c.value,m=l.x+g.x,x=l.y+g.y;if(m>=0&&m<i&&x>=0&&x<a){var y=x*i+m;r[y]&&!s[y]&&(s[y]=!0,h.push({x:m,y:x}))}}}catch(p){f.e(p)}finally{f.f()}}return u}},{key:"Dilate",value:function(t){if(this.IsEmpty)return new e(0,0);var n=this.width,i=this.height,a=this.pixels,r=e.Clone(this),u=r.imagePixels;return r.foreachPixel((function(e,r,s){if(!s&&e>=t&&e<n-t&&r>=t&&r<i-t){for(var o=!1,h=2*t+1,c=r-t;c<=r+t;c++){for(var l=c*n+e-t,f=l;f<h+l;f++)o||(o=a[f]);if(o)break}u[r*n+e]=o}})),r}},{key:"Overlay",value:function(e,t,n){var i=t.r,a=t.g,r=t.b,u=t.a,s=void 0===u?255:u;if(!n&&(this.width!==e.width||this.height!==e.height))throw new Error("Invalid data : Mask size ".concat(this.width,"x").concat(this.height," and image data ").concat(e.width,"x").concat(e.height));if(n){if(n.x<0||n.y<0)throw new Error("negative offset not supported : ".concat(n.x,",").concat(n.y));if(n.x+this.width>e.width||n.y+this.height>e.height)throw new Error("Invalid offset : mask shall be completly inside the image ".concat(n.x+this.width,"x").concat(n.y+this.height," and image ").concat(e.width,"x").concat(e.height))}var o=n?n.x:0,h=n?n.y:0,c=e.data,l=4*(h*e.width+o),f=s/255;i*=f,r*=f,a*=f;var g=1-f,v=4*e.width,m=4*(o+this.width),x=4*(e.width-this.width);this.pixels.forEach((function(e){if(e){var t=l,n=c[l++]*g+i,u=c[l++]*g+a,o=c[l++]*g+r,h=c[l++]*g+s;c[t++]=n,c[t++]=u,c[t++]=o,c[t++]=h}else l+=4;l%v===m&&(l+=x)}))}},{key:"Components",value:function(e){var t=this,n=[];return this.foreachPixel((function(i,a,r){if(r){var u=t.Fill(i,a),s=u.area;n.push({mask:u,area:s}),n.sort((function(e,t){return t.area-e.area})),n.length=Math.min(n.length,e),t.Minus(u)}})),n.map((function(e){return e.mask}))}},{key:"Boundaries",value:function(){var e=this.width,t=this.height,n=0,i=0;return this.foreachPixel((function(a,r,u){u&&(e=a<e?a:e,t=r<t?r:t,n=a>n?a:n,i=r>i?r:i)})),y.FromValues(e,t,n+1,i+1)}},{key:"checkSize",value:function(e,t){if(e<0||e>this.w||t<0||t>this.height)throw new Error("Wrong coordinate for mask (".concat(e,",").concat(t,") and mask size ").concat(this.w,"x").concat(this.height))}}],[{key:"Clone",value:function(t){var n=new e(t.width,t.height);return n.pixels=(0,g.Z)(t.pixels),n}}]),e}(),x=function(e,t,n){return new ImageData(e,t,n)},y=function(){function e(){(0,s.Z)(this,e)}return(0,o.Z)(e,null,[{key:"SetImageDataAllocator",value:function(t){e.allocator=t}},{key:"FromPoints",value:function(t,n){return e.FromValues(t.x,t.y,n.x,n.y)}},{key:"FromValues",value:function(e,t,n,i){var a=Math.min(e,n),r=Math.max(e,n),u=Math.min(t,i);return{ulc:{x:a,y:u},size:{width:r-a,height:Math.max(t,i)-u}}}},{key:"FromImage",value:function(e){return{ulc:{x:0,y:0},size:{width:e.width,height:e.height}}}},{key:"Empty",get:function(){return{ulc:{x:0,y:0},size:{width:0,height:0}}}},{key:"IsEmpty",value:function(e){return e.size.width<=0||e.size.height<=0}},{key:"Merge",value:function(t){var n=e.Empty;if(t.length>0){var i=t[0].ulc.x,a=t[0].ulc.y,r=i,u=a;t.forEach((function(e){i=Math.min(e.ulc.x,i),a=Math.min(e.ulc.y,a),r=Math.max(e.ulc.x+e.size.width,r),u=Math.max(e.ulc.y+e.size.height,u)})),n=e.FromValues(i,a,r,u)}return n}},{key:"Dilate",value:function(e,t,n){return{ulc:{x:e.ulc.x-t,y:e.ulc.y-n},size:{width:e.size.width+2*t,height:e.size.height+2*n}}}},{key:"Intersect",value:function(t){var n=e.Empty;if(t.length>0){var i=t[0].ulc.x,a=t[0].ulc.y,r=i+t[0].size.width,u=a+t[0].size.height;t.forEach((function(e){i=Math.max(e.ulc.x,i),a=Math.max(e.ulc.y,a),r=Math.min(e.ulc.x+e.size.width,r),u=Math.min(e.ulc.y+e.size.height,u)})),n={ulc:{x:i,y:a},size:{width:r-i,height:u-a}}}return n}},{key:"CropImage",value:function(t,n){var i=e.FromImage(n),a=e.Intersect([t,i]),r=Math.max(a.size.width,0),u=Math.max(a.size.height,0),s=new Uint8ClampedArray(r*u*4),o=e.allocator(s,r,u);if(r*u>0)for(var h=n.data,c=0,l=a.ulc.y;l<a.ulc.y+u;l++)for(var f=4*(l*n.width+t.ulc.x),g=0;g<r;g++)s[c++]=h[f++],s[c++]=h[f++],s[c++]=h[f++],s[c++]=h[f++];return o}},{key:"CropMask",value:function(t,n){var i=e.FromImage(n),a=e.Intersect([t,i]),r=Math.max(a.size.width,0),u=Math.max(a.size.height,0),s=new m(r,u);if(r*u>0)for(var o=n.width,h=n.imagePixels,c=s.imagePixels,l=0,f=a.ulc.y;f<a.ulc.y+a.size.height;f++)for(var g=f*o+a.ulc.x,v=g+a.size.width;g<v;)c[l++]=h[g++];return s}}]),e}();y.allocator=x;var p=function(){function e(){(0,s.Z)(this,e)}return(0,o.Z)(e,null,[{key:"Process",value:function(e,t,n,i){var a=y.Merge(t),r=n,u=[],s=1/(i*i);if(!y.IsEmpty(a)){var o=25,h=25;a.size.width<256&&(o=Math.max(o,(256-a.size.width)/2|0)),a.size.height<256&&(h=Math.max(h,(256-a.size.height)/2|0));var c=y.Dilate(a,o,h);r=y.CropImage(c,n),u=e.map((function(e){return{leaf:e.leaf*s|0,path:e.path*s|0}}))}return{imgData:r,areas:u}}}]),e}(),d=function(){function e(){(0,s.Z)(this,e)}return(0,o.Z)(e,null,[{key:"SetSearchParam",value:function(t){e.params=new URLSearchParams(t)}},{key:"PackMode",get:function(){var t;return null!==(t=e.params.get("PackMode"))&&void 0!==t?t:"Lab"}}]),e}();d.params=new URLSearchParams("undefined"===typeof window?"":window.location.search);var k,w=function(){function e(){(0,s.Z)(this,e)}return(0,o.Z)(e,null,[{key:"Uint8",value:function(e,t){return new b(Uint8Array.BYTES_PER_ELEMENT,Uint8Array,e,t)}},{key:"Uint16",value:function(e,t){return new b(Uint16Array.BYTES_PER_ELEMENT,Uint16Array,e,t)}},{key:"Float32",value:function(e,t){return new b(Float32Array.BYTES_PER_ELEMENT,Float32Array,e,t)}},{key:"Image",value:function(t,n,i){switch(t){case"Uint8":return e.Uint8(n,i);case"Uint16":return e.Uint16(n,i);case"Float32":return e.Float32(n,i)}}}]),e}(),b=function(){function e(t,n,i,a){(0,s.Z)(this,e),this.buffer=void 0,this.pixels=void 0;var r=i*a,u=new ArrayBuffer(r*t);this.pixels=Array.from(Array(a),(function(e,a){return new n(u,i*t*a,i)})),this.buffer=new n(u,0,r)}return(0,o.Z)(e,[{key:"imageType",get:function(){return this.pixels[0].constructor.name.replace("Array","")}},{key:"imagePixels",get:function(){return this.buffer}},{key:"imageBuffer",get:function(){return this.buffer.buffer}},{key:"height",get:function(){return this.pixels.length}},{key:"width",get:function(){return this.pixels[0].length}},{key:"toString",value:function(){return"image ".concat(this.imageType," ").concat(this.width,"x").concat(this.height)}},{key:"get",value:function(e,t){if(!this.checkBoundary(e,t))throw new Error("Invalid image coordinates queried: image size ".concat(this.width,"x").concat(this.height," pixel ").concat(e,",").concat(t));return this.pixels[t][e]}},{key:"foreachPixel",value:function(e){this.pixels.forEach((function(t,n){for(var i=0;i<t.length;i++)e(i,n,t[i])}))}},{key:"maxValue",value:function(){return this.buffer.reduce((function(e,t,n){return Math.max(t,e)}),this.buffer[0])}},{key:"minValue",value:function(){return this.buffer.reduce((function(e,t,n){return Math.min(t,e)}),this.buffer[0])}},{key:"getRow",value:function(e){if(e<0||e>this.height)throw new Error("Invalid y coordinate queried : image height ".concat(this.height," y ").concat(e));return this.pixels[e]}},{key:"set",value:function(e,t,n){if(!this.checkBoundary(e,t))throw new Error("Invalid image coordinates set: image size ".concat(this.width,"x").concat(this.height," pixel ").concat(e,",").concat(t));this.pixels[t][e]=n}},{key:"convertTo8Uint",value:function(e,t){return this.convertTo("Uint8",e,t)}},{key:"convertTo16Uint",value:function(e,t){return this.convertTo("Uint16",e,t)}},{key:"convertTo32Float",value:function(e,t){return this.convertTo("Float32",e,t)}},{key:"convertTo",value:function(e,t,n){var i=this,a=w.Image(e,this.width,this.height),r=a.imagePixels;return null!=t&&null!=n?r.forEach((function(e,a){return r[a]=t*i.buffer[a]+n})):r.forEach((function(e,t){return r[t]=i.buffer[t]})),a}},{key:"checkBoundary",value:function(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height}}]),e}(),P=function(){function e(){(0,s.Z)(this,e)}return(0,o.Z)(e,null,[{key:"SetImageDataAllocator",value:function(t){e.allocator=t}},{key:"fromHSV",value:function(t,n,i){for(var a=t.width,r=t.height,u=new Uint8ClampedArray(a*r*4),s=t.imagePixels,o=n.imagePixels,h=i.imagePixels,c=0,l=0;l<a*r;l++){var f=s[l],g=o[l],v=h[l],m=this.Hsv2Rgb(f,g,v);u[c++]=255*m.r,u[c++]=255*m.g,u[c++]=255*m.b,u[c++]=255}return e.allocator(u,a,r)}},{key:"toHSV",value:function(e){for(var t=e.width,n=e.height,i=w.Float32(t,n),a=w.Float32(t,n),r=w.Float32(t,n),u=i.imagePixels,s=a.imagePixels,o=r.imagePixels,h=e.data,c=0,l=0;l<t*n;l++){var f=h[c++],g=h[c++],v=h[c++];c++;var m=this.Rgb2Hsv(f/255,g/255,v/255);u[l]=m.h,s[l]=m.s,o[l]=m.v}return{hue:i,sat:a,val:r}}},{key:"Rgb2Hsv",value:function(e,t,n){var i={h:0,v:0,s:0},a=Math.min(e,t,n),r=Math.max(e,t,n),u=r-a;return i.v=r,u<1e-5?(i.h=0,i.s=0):(i.s=u/r,e===r&&(i.h=0+(t-n)/u),t===r&&(i.h=2+(n-e)/u),n===r&&(i.h=4+(e-t)/u)),i.h*=60,i.h<0&&(i.h+=360),i}},{key:"Hsv2Rgb",value:function(e,t,n){var i={r:n,g:n,b:n};if(t>0){var a=e/60,r=Math.floor(a),u=a-r,s=n*(1-t),o=n*(1-t*u),h=n*(1-t*(1-u));switch(r){case 0:i.r=n,i.g=h,i.b=s;break;case 1:i.r=o,i.g=n,i.b=s;break;case 2:i.r=s,i.g=n,i.b=h;break;case 3:i.r=s,i.g=o,i.b=n;break;case 4:i.r=h,i.g=s,i.b=n;break;default:i.r=n,i.g=s,i.b=o}}return i}},{key:"fromLab",value:function(t,n,i){for(var a=t.width,r=t.height,u=new Uint8ClampedArray(a*r*4),s=t.imagePixels,o=n.imagePixels,h=i.imagePixels,c=0,l=0;l<a*r;l++){var f=s[l],g=o[l],v=h[l],m=this.Lab2Rgb(f,g,v);u[c++]=255*m.r,u[c++]=255*m.g,u[c++]=255*m.b,u[c++]=255}return e.allocator(u,a,r)}},{key:"toLab",value:function(e){for(var t=e.width,n=e.height,i=w.Float32(t,n),a=w.Float32(t,n),r=w.Float32(t,n),u=i.imagePixels,s=a.imagePixels,o=r.imagePixels,h=e.data,c=0,l=0;l<t*n;l++){var f=h[c++],g=h[c++],v=h[c++];c++;var m=this.Rgb2Lab(f/255,g/255,v/255);u[l]=m.l,s[l]=m.a,o[l]=m.b}return{l:i,a:a,b:r}}},{key:"Rgb2Lab",value:function(e,t,n){var i=(.4124*(e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92)+.3576*(t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92)+.1805*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92))/.95047,a=(.2126*e+.7152*t+.0722*n)/1,r=(.0193*e+.1192*t+.9505*n)/1.08883;return i=i>.008856?Math.pow(i,1/3):7.787*i+16/116,{l:116*(a=a>.008856?Math.pow(a,1/3):7.787*a+16/116)-16,a:500*(i-a),b:200*(a-(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116))}}},{key:"Lab2Rgb",value:function(e,t,n){var i=(e+16)/116,a=t/500+i,r=i-n/200,u={r:3.2406*(a=.95047*(a*a*a>.008856?a*a*a:(a-16/116)/7.787))+-1.5372*(i=1*(i*i*i>.008856?i*i*i:(i-16/116)/7.787))+-.4986*(r=1.08883*(r*r*r>.008856?r*r*r:(r-16/116)/7.787)),g:-.9689*a+1.8758*i+.0415*r,b:.0557*a+-.204*i+1.057*r};return u.r=u.r>.0031308?1.055*Math.pow(u.r,1/2.4)-.055:12.92*u.r,u.g=u.g>.0031308?1.055*Math.pow(u.g,1/2.4)-.055:12.92*u.g,u.b=u.b>.0031308?1.055*Math.pow(u.b,1/2.4)-.055:12.92*u.b,u.r=Math.max(0,Math.min(1,u.r)),u.g=Math.max(0,Math.min(1,u.g)),u.b=Math.max(0,Math.min(1,u.b)),u}},{key:"toRGB",value:function(e){for(var t=e.width,n=e.height,i=w.Uint8(t,n),a=w.Uint8(t,n),r=w.Uint8(t,n),u=t*n,s=0,o=e.data,h=i.imagePixels,c=a.imagePixels,l=r.imagePixels,f=0;f<u;f++)h[f]=o[s++],c[f]=o[s++],l[f]=o[s++],s++;return{r:i,g:a,b:r}}},{key:"fromRGB",value:function(t,n,i){for(var a=t.width,r=t.height,u=a*r,s=0,o=new Uint8ClampedArray(a*r*4),h=t.imagePixels,c=n.imagePixels,l=i.imagePixels,f=0;f<u;f++)o[s++]=h[f],o[s++]=c[f],o[s++]=l[f],o[s++]=255;return e.allocator(o,a,r)}}]),e}();P.allocator=x,function(e){e[e.Image=0]="Image",e[e.Transparent=1]="Transparent"}(k||(k={}));var M=function(){function e(){(0,s.Z)(this,e)}return(0,o.Z)(e,null,[{key:"Process",value:function(t,n,i,a,r,u){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:k.Image,o=e.leafs(t,n,i,a),h=e.pathogen(o,t,r,u),c=e.overlay(o,h,t,s);return c}},{key:"SetPackFunction",value:function(){e.Pack=e.SelectDefaultPacking()}},{key:"SelectDefaultPacking",value:function(){var t=e.LabPack;switch(d.PackMode){case"RGB":t=e.RgbPack;break;case"HSV":t=e.HsvPack}return t}},{key:"RgbPack",value:function(e,t,n){return e<<16|t<<8|n}},{key:"HsvPack",value:function(e,t,n){e/=255,t/=255,n/=255;var i=P.Rgb2Hsv(e,t,n),a=i.h,r=i.s;return(a|=0)<<8|(r=255*r|0)}},{key:"LabPack",value:function(e,t,n){e/=255,t/=255,n/=255;var i=P.Rgb2Lab(e,t,n),a=i.a,r=i.b;return a=255*a/256|0,r=255*r/256|0,(a+=128)<<8|(r+=128)}},{key:"pathogen",value:function(t,n,i,a){var r=[];return a.size>0&&t.forEach((function(t){var u=e.getPathMask(t,n,i,a);r.push(u)})),r}},{key:"overlay",value:function(t,n,i,a){var r=[],u=[],s=[{r:255,g:0,b:0},{r:255,g:255,b:0}],o={r:255,g:128,b:0};return e.setBackground(a,i),t.forEach((function(e,t){var a,o,h=s[t%s.length],c=e.area,l=e.Boundaries(),f=null!==(a=null===(o=n[t])||void 0===o?void 0:o.mask.area)&&void 0!==a?a:0;r.push({leaf:c,path:f}),u.push(l);var g=e.Dilate(1);g.Minus(e),g.Overlay(i,h)})),n.forEach((function(e){var t=e.mask,n=e.ulc;t.Not();var a=t.Dilate(1);a.Minus(t),a.Overlay(i,o,n)})),{areas:r,bboxs:u}}},{key:"leafs",value:function(e,t,n,i){var a=P.toHSV(e),r=a.hue,u=a.sat,s=new m(e.width,e.height),o=s.imagePixels,h=r.imagePixels,c=u.imagePixels;t*=360/255,n*=1/255,h.forEach((function(e,i){return o[i]=e>t||c[i]<n}));var l=s.Fill(1,1);l.Not();var f=l.Components(i);return f}},{key:"setBackground",value:function(e,t){for(var n=e===k.Image?0:t.data.length,i=t.data,a=0;a<n;)i[a++]=0,i[a++]=0,i[a++]=0,i[a++]=0}},{key:"getPathMask",value:function(t,n,i,a){var r=new m(t.width,t.height),u=t.imagePixels,s=r.imagePixels,o=n.data,h=0;u.forEach((function(t,n){if(t){var r=o[h++],u=o[h++],c=o[h++];h++;var l=e.Pack(r,u,c);s[n]=!i.has(l)&&a.has(l)}else h+=4}));var c=r.Dilate(1),l=c.Boundaries(),f=y.Dilate(l,1,1),g=y.CropMask(f,c);g.Not();var v=g.Fill(0,0);(v=v.Dilate(2)).Not();var x=(v=v.Dilate(2)).Components(1);return{mask:x.length?x[0]:new m(0,0),ulc:f.ulc}}}]),e}();M.Pack=M.SelectDefaultPacking(),self.onmessage=function(){var e=(0,i.Z)(r().mark((function e(t){var n,i,a,u,s,o,h,l,f,g,v,m,x,y,k,w,b,P,E;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.data,i=n.file,a=n.name,u=n.nDishes,s=n.hueThr,o=n.satThr,h=n.nLeafs,l=n.leafVals,f=n.pathVals,g=n.urlParam,d.SetSearchParam(g),M.SetPackFunction(),v=new c([i],u,1024),m=v.List.indexOf(a),e.next=7,v.getImage(m);case 7:x=e.sent,y=x.imgData,k=x.scale,w=M.Process(y,s,o,h,new Set(l),new Set(f)),b=w.areas,P=w.bboxs,E=p.Process(b,P,y,k),r=E,self.postMessage(r);case 13:case"end":return e.stop()}var r}),e)})));return function(t){return e.apply(this,arguments)}}()}},t={};function n(i){var a=t[i];if(void 0!==a)return a.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,n),r.exports}n.m=e,n.x=function(){var e=n.O(void 0,[271],(function(){return n(765)}));return e=n.O(e)},function(){var e=[];n.O=function(t,i,a,r){if(!i){var u=1/0;for(c=0;c<e.length;c++){i=e[c][0],a=e[c][1],r=e[c][2];for(var s=!0,o=0;o<i.length;o++)(!1&r||u>=r)&&Object.keys(n.O).every((function(e){return n.O[e](i[o])}))?i.splice(o--,1):(s=!1,r<u&&(u=r));if(s){e.splice(c--,1);var h=a();void 0!==h&&(t=h)}}return t}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[i,a,r]}}(),n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce((function(t,i){return n.f[i](e,t),t}),[]))},n.u=function(e){return"static/js/"+e+".e722dad0.chunk.js"},n.miniCssF=function(e){},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/LeafSize/",function(){var e={765:1};n.f.i=function(t,i){e[t]||importScripts(n.p+n.u(t))};var t=self.webpackChunkleafsize=self.webpackChunkleafsize||[],i=t.push.bind(t);t.push=function(t){var a=t[0],r=t[1],u=t[2];for(var s in r)n.o(r,s)&&(n.m[s]=r[s]);for(u&&u(n);a.length;)e[a.pop()]=1;i(t)}}(),function(){var e=n.x;n.x=function(){return n.e(271).then(e)}}();n.x()}();
//# sourceMappingURL=765.a5d50c5d.chunk.js.map